// Generated by CoffeeScript 1.3.3
(function(){var e,t,n;window.addEventListener("load",function(){var e,n,r,i,s;return e=new t({container:"lock-screen",width:400,height:400,onSuccess:function(){return console.log("Pattern successed")},onFailure:function(){return console.log("Pattern unmatched")},pattern:"1-2-3-4-5-6-7-8-9"}),s=document.getElementById("unlock-button"),r=document.getElementById("save-pattern-button"),n=document.getElementById("reset-button"),i=!0,r.addEventListener("click",function(){var t;return t=this.getElementsByClassName("gray"),t.className==="red"?(this.innerHTML="<span class='gray'></span>Record Pattern",t.className="gray",e.stopRecordPattern(),s.style.display="inline",n.style.display="inline"):(this.innerHTML="<span class='red'></span>Recording...",t.className="red",e.startRecordPattern(),s.style.display="none",n.style.display="none"),!0},!1),s.addEventListener("click",function(){var t=this;return e.unlock()!==!1?(this.className="button green",alert("Access Granted!")):(this.className="button red",setTimeout(function(){return t.className="button blue",e.clear(),!0},1e3)),!0},!1),n.addEventListener("click",function(){return e.reset(),s.className="button blue",!0},!1),document.addEventListener("keyup",function(t){return(t.keyCode||t.which)===72&&(e.showHint(i),i=!i),!0}),!0}),e=function(){function e(e,t){var n,r,i=this;this._id=e,this._x=t.x,this._y=t.y,this._dotInnerLayer=t.innerLayer,this._listenerLayer=t.listenerLayer,this._pattern=t.pattern,this._innerCircleRadius=5,this._innerCircleFill="rgba(255,255,255,0)",this._innerCircleStroke="#aaa",this._strokeWidth=4,r=this._dotInnerLayer.getStage(),n=Math.min(r.getWidth(),r.getHeight()),this._outerCircleConfig={radius:n/10,fill:"rgba(255,255,255,0)",stroke:"lime",strokeWidth:this._strokeWidth},this._innerCircle=function(){return new Kinetic.Circle({x:i._x,y:i._y,radius:i._innerCircleRadius,fill:i._innerCircleFill,stroke:i._innerCircleStroke,strokeWidth:i._strokeWidth})}(),this._listenerCircle=function(){return new Kinetic.Circle({x:i._x,y:i._y,radius:i._outerCircleConfig.radius,fill:"transparent"})}(),this._listenerCircle.on("mousedown mousemove touchmove",this._showUserDot.bind(this)),this._listenerCircle.on("mouseout",this._mouseout.bind(this)),this._listenerCircle.on("mouseup touchend",this._isValid.bind(this)),this._listenerLayer.add(this._listenerCircle),this._dotInnerLayer.add(this._innerCircle),this._dotInnerLayer.draw()}return e.prototype.getX=function(){return this._x},e.prototype.getY=function(){return this._y},e.prototype._isValid=function(){var e,t;return this._pattern.isRecording?!1:(t=function(){return document.createEvent?(t=document.createEvent("HTMLEvents"),t.initEvent("click",!0,!0),t):(t=document.createEventObject(),t.eventType="click",t)}(),e=document.getElementById("unlock-button"),e.dispatchEvent?e.dispatchEvent(t):e.fireEvent&&e.fireEvent("on"+t.eventType,t),!0)},e.prototype._showUserDot=function(){var e,t=this;return document.body.style.cursor="pointer",this._innerCircle.setStrokeWidth(2),this._dotInnerLayer.draw(),e=function(){return new Kinetic.Circle({x:t._innerCircle.getX(),y:t._innerCircle.getY(),radius:0,fill:t._outerCircleConfig.fill,stroke:t._outerCircleConfig.stroke,strokeWidth:t._outerCircleConfig.strokeWidth})}(),this._pattern.addDot(e,this._outerCircleConfig)},e.prototype._mouseover=function(){return document.body.style.cursor="pointer",!0},e.prototype._mouseout=function(){return document.body.style.cursor="default",!0},e.prototype.clear=function(){return this._innerCircle.setFill(this._innerCircleFill),this._innerCircle.setRadius(this._innerCircleRadius),this._innerCircle.setStrokeWidth(this._innerCircleRadius),this._dotInnerLayer.draw(),!0},e}(),t=function(){function t(e){var t=this;this._name="LockScreen";try{window.Kinetic}catch(r){throw"["+this._name+"] Kinetic.js was not detected!"}try{e.container}catch(r){throw"["+this._name+"] A container must be specified!"}return this._config={},this._config.width=e.width||400,this._config.height=e.height||400,this._config.container=e.container||null,this._config.onSuccess=e.onSuccess||null,this._config.onFailure=e.onFailure||null,this._config.pattern=e.pattern||null,this._stage=function(){return new Kinetic.Stage({container:t._config.container,width:t._config.width,height:t._config.height})}(),this._dotsInnerLayer=new Kinetic.Layer,this._dotsOuterLayer=new Kinetic.Layer,this._lineLayer=new Kinetic.Layer,this._listenerLayer=new Kinetic.Layer,this._hintLayer=new Kinetic.Layer,this._hintLayer.setAlpha(.1),this._stage.add(this._dotsInnerLayer),this._stage.add(this._dotsOuterLayer),this._stage.add(this._lineLayer),this._stage.add(this._hintLayer),this._stage.add(this._listenerLayer),this._pattern=function(){return new n({patternLayer:t._dotsOuterLayer,lineLayer:t._lineLayer,hintLayer:t._hintLayer})}(),this._dots=[],this._draw(),this._config.pattern!=null&&this._parseAndSaveUserPattern(this._config.pattern),this}return t.prototype._parseAndSaveUserPattern=function(e){var t,n,r,i,s,o;r=e.split(/[#\|_,; -]+/);for(s=0,o=r.length;s<o;s++)i=r[s],n=+i-1,t=this._dots[n],this._pattern.shouldDrawDot(t)&&this._pattern.savePatternDot(t);return this._pattern.buildHint(),!0},t.prototype._draw=function(){var t,n,r,i,s,o,u,a,f,l,c,h;l=this._stage.getWidth(),t=this._stage.getHeight(),i=Math.floor(l/2),r=Math.floor(t/2),o=Math.floor(l/3),s=Math.floor(t/3),f=[{x:i-o,y:r-s},{x:i,y:r-s},{x:i+o,y:r-s},{x:i-o,y:r},{x:i,y:r},{x:i+o,y:r},{x:i-o,y:r+s},{x:i,y:r+s},{x:i+o,y:r+s}];for(n=c=0,h=f.length;c<h;n=++c)a=f[n],u={pattern:this._pattern,innerLayer:this._dotsInnerLayer,listenerLayer:this._listenerLayer,x:a.x,y:a.y},this._dots.push(new e(n,u));return this},t.prototype.clear=function(){var e,t,n,r;this._pattern.clear(),r=this._dots;for(t=0,n=r.length;t<n;t++)e=r[t],e.clear();return this},t.prototype.reset=function(){return this.clear(),this._pattern.clearSavedPattern(),this},t.prototype.unlock=function(){var e,t;return this._pattern.isValid()?(this.validatePattern(),(e=this._config.onSuccess)!=null&&e.call(this),!0):(this.invalidatePattern(),(t=this._config.onFailure)!=null&&t.call(this),!1)},t.prototype.validatePattern=function(){return this},t.prototype.invalidatePattern=function(){var e,t,n,r,i;t=this._dotsOuterLayer.getChildren(),n=this._lineLayer.getChildren(),n[0]!=null&&n[0].setFill("rgba(255,0,0,0.5)");for(r=0,i=t.length;r<i;r++)e=t[r],e.setStroke("rgba(255,0,0,0.8)");return this._dotsOuterLayer.draw(),this._lineLayer.draw(),this._pattern.setToBeClearedOnNextUse(!0),this},t.prototype.startRecordPattern=function(){return this.clear(),this._pattern.clearSavedPattern(),this._pattern.setRecording(!0),this._pattern.setToBeClearedOnNextUse(!1),this},t.prototype.stopRecordPattern=function(){return this.clear(),this._pattern.setRecording(!1),this._pattern.buildHint(),this},t.prototype.showHint=function(e){return e?this._pattern.showHint():this._pattern.hideHint(),this},t}(),n=function(){function e(e){var t,n;this._userDots=[],this._savedPattern=[],n=e.patternLayer.getStage(),t=n.getMousePosition()||{x:n.getWidth()/2,y:n.getHeight()/2},this._x0=t.x,this._y0=t.y,this._x=this._x0,this._y=this._y0,this._patternLayer=e.patternLayer,this._lineLayer=e.lineLayer,this._hintLayer=e.hintLayer,this._isRecording=!1,this._toBeClearedOnNextUse=!1}return e.prototype.setRecording=function(e){return this._isRecording=e,!0},e.prototype.setToBeClearedOnNextUse=function(e){return this._toBeClearedOnNextUse=e,!0},e.prototype.buildHint=function(){var e;return this._hintLayer.removeChildren(),e=this._newLine(this._savedPattern),this._hintLayer.add(e),!0},e.prototype.showHint=function(){return this._hintLayer.show(),this._hintLayer.draw(),!0},e.prototype.hideHint=function(){return this._hintLayer.hide(),this._hintLayer.draw(),!0},e.prototype.addDot=function(e,t){var n;return this._toBeClearedOnNextUse&&(this.clear(),this._toBeClearedOnNextUse=!1),n=this.shouldDrawDot(e),n&&(this._isRecording?this.savePatternDot(e):n&&this.addUserDot(e),this._patternLayer.add(e),this.setTransition(e,t),this._patternLayer.draw()),!0},e.prototype.shouldDrawDot=function(e){var t,n,r,i;n=this._isRecording?this._savedPattern:this._userDots;for(r=0,i=n.length;r<i;r++){t=n[r];if(e.getX()===t.getX()&&e.getY()===t.getY())return!1}return!0},e.prototype.setTransition=function(e,t){var n=this;return function(){return e.transitionTo({radius:t.radius,duration:.1,callback:n.drawLine.bind(n)})}(),!0},e.prototype.addUserDot=function(e){return this._userDots.push(e),!0},e.prototype.drawLine=function(){var e,t;return e=this._isRecording?this._savedPattern:this._userDots,e.length>=2&&(t=this._newLine(e),this._lineLayer.removeChildren(),this._lineLayer.add(t),this._lineLayer.draw()),!0},e.prototype._newLine=function(e){return new Kinetic.Shape({drawFunc:function(){var t,n,r,i,s,o;r=e[0],t=this.getContext(),t.beginPath(),t.moveTo(r.getX(),r.getY());for(i=s=1,o=e.length-1;1<=o?s<=o:s>=o;i=1<=o?++s:--s)n=e[i],t.lineTo(n.getX(),n.getY());return t.lineJoin="round",t.lineCap="round",t.strokeStyle="rgba(255,255,255,0.5)",t.lineWidth=5,t.stroke(),t.closePath(),!0},stroke:"rgba(255,255,255,0.5)",strokeWidth:5})},e.prototype.isValid=function(){var e,t,n,r,i;if(this._savedPattern.length!==this._userDots.length)return!1;i=this._savedPattern;for(e=n=0,r=i.length;n<r;e=++n){t=i[e];if(t.getX()!==this._userDots[e].getX()||t.getY()!==this._userDots[e].getY())return!1}return!0},e.prototype.clear=function(){return this._clearUserDots(),this._clearLayers(),this},e.prototype._clearUserDots=function(){return this._userDots=[]},e.prototype._clearLayers=function(){var e,t,n,r,i,s,o,u=this;t=this._patternLayer.getChildren(),r=t.length,i=function(){return e.transitionTo({radius:0,duration:.1,callback:function(){return r-1===n?(u._patternLayer.clear(),u._patternLayer.removeChildren(),u._patternLayer.draw(),!0):!1}})};for(n=s=0,o=t.length;s<o;n=++s)e=t[n],i();return this._lineLayer.clear(),this._lineLayer.removeChildren(),this._lineLayer.draw(),!0},e.prototype.savePatternDot=function(e){return this._savedPattern.push({x:e.getX(),y:e.getY(),getX:function(){return this.x},getY:function(){return this.y}}),!0},e.prototype.clearSavedPattern=function(){return this._savedPattern=[],this._hintLayer.removeChildren(),this._hintLayer.clear(),this._hintLayer.draw(),!0},e}()}).call(this);